(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{681:function(e,s,a){"use strict";a.r(s);var n=a(40),t=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"一-简单架构图示参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-简单架构图示参考"}},[e._v("#")]),e._v(" 一 简单架构图示参考")]),e._v(" "),a("p",[e._v("更新中...")]),e._v(" "),a("h2",{attrs:{id:"二-部署glance"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-部署glance"}},[e._v("#")]),e._v(" 二 部署glance")]),e._v(" "),a("p",[e._v("yum install memcached python-memcached\nsystemctl enable memcached.service\nsystemctl start memcached.service")]),e._v(" "),a("p",[a("strong",[e._v("step 1：glance关于数据库的操作")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mysql -u root -p #登入数据库\nCREATE DATABASE glance; #新建库keystone\nGRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' \\\n  IDENTIFIED BY '123'; #新建本地访问glance库的账号\nGRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' \\\n  IDENTIFIED BY '123'; #新建远程访问glance库的账号\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("p",[a("strong",[e._v("step 2：glance关于keystone的操作")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('soure admin-openrc #执行管理员脚本\n#为glance的使用者创建用户\nopenstack user create --domain default --password-prompt glance\n\n#对glance-service添加role角色,提示：用户glance只有在一个确定的项目service内才有角色的概念，单独的用户或者单独的项目都是无法绑定角色的。\nopenstack role add --project service --user glance admin\n\n\n#创建glance服务的catalog：service+endpoint\nopenstack service create --name glance \\\n--description "OpenStack Image" image\n\nopenstack endpoint create --region RegionOne \\\nimage public http://192.168.31.57:9292\nopenstack endpoint create --region RegionOne \\\nimage internal http://192.168.31.57:9292\nopenstack endpoint create --region RegionOne \\\nimage admin http://192.168.31.57:9292\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br")])]),a("p",[a("strong",[e._v("step 3：安装软件包")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("yum -y install openstack-glance\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("strong",[e._v("step 4：配置/etc/glance/glance.conf")])]),e._v(" "),a("p",[e._v("大前提：每一条配置都应该新增到文件中，一定不要打开注释在原有的基础上修改。")]),e._v(" "),a("p",[e._v("创建本地存储：")]),e._v(" "),a("p",[a("strong",[e._v("1.一定要在opesntack-glance-api.service服务启动之前部署好存储设备，因为该服务在启动时会加载存储驱动检索存储设备，如果事先不存在，就意味着该服务没有识别到任何可用的存储设备，即便是后来你又新增了存储，仍然是无效的，最终导致你上传镜像失败；")])]),e._v(" "),a("p",[a("strong",[e._v("2.一定要赋予opesntack-glance-api.service服务对存储设备的可写权限。")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("mkdir -p /var/lib/glance/images\nchown -R glance.glance /var/lib/glance/images\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("配置/etc/glance/glance-api.conf")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[database]\nconnection = mysql+pymysql://glance:123@192.168.31.57/glance\n\n[keystone_authtoken]\nauth_uri = http://192.168.31.57:5000\nauth_url = http://192.168.31.57:35357\nmemcached_servers = 192.168.31.57:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = glance\npassword = 123\n\n[paste_deploy]\nflavor = keystone\n\n[glance_store]\nstores = file,http\ndefault_store = file\nfilesystem_store_datadir = /var/lib/glance/images/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br")])]),a("p",[e._v("配置/etc/glance/glance-registry.conf")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[database]\nconnection = mysql+pymysql://glance:123@192.168.31.57/glance\n\n[keystone_authtoken]\nauth_uri = http://192.168.31.57:5000\nauth_url = http://192.168.31.57:35357\nmemcached_servers = 192.168.31.57:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = glance\npassword = 123\n\n[paste_deploy]\nflavor = keystone\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br")])]),a("p",[a("strong",[e._v("step 5: 初始化数据库glance")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('su -s /bin/sh -c "glance-manage db_sync" glance\n\'\'\'\n忽略以下打印，此乃正常性行为：\nOption "verbose" from group "DEFAULT" is deprecated for removal.  Its value may be silently ignored in the future.\n/usr/lib/python2.7/site-packages/oslo_db/sqlalchemy/enginefacade.py:1171:...... oslo_db.sqlalchemy.enginefacade\n...... a future release.")\n  result = self._query(query)\n\'\'\'\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("p",[a("strong",[e._v("step 6：启动glance且设置开机启动")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("systemctl enable openstack-glance-api.service \\\nopenstack-glance-registry.service\nsystemctl start openstack-glance-api.service \\\nopenstack-glance-registry.service\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("h2",{attrs:{id:"三-验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-验证"}},[e._v("#")]),e._v(" 三 验证")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('source admin-openrc\n\n#如果没有wget则必须yum -y install wget\nwget http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img\n\nopenstack image create "cirros" \\\n  --file cirros-0.3.4-x86_64-disk.img \\\n  --disk-format qcow2 --container-format bare \\\n  --public\n\n\nopenstack image list\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br")])]),a("p",[e._v("For information about the openstack image create parameters, see "),a("a",{attrs:{href:"http://docs.openstack.org/user-guide/common/cli-manage-images.html#create-or-update-an-image-glance",target:"_blank",rel:"noopener noreferrer"}},[e._v("Create or update an image (glance)"),a("OutboundLink")],1),e._v(" in the OpenStack User Guide.")]),e._v(" "),a("p",[e._v("For information about disk and container formats for images, see "),a("a",{attrs:{href:"http://docs.openstack.org/image-guide/image-formats.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Disk and container formats "),a("OutboundLink")],1),e._v("for images in the OpenStack Virtual Machine Image Guide.")])])}),[],!1,null,null,null);s.default=t.exports}}]);