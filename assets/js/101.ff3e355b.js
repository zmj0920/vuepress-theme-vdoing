(window.webpackJsonp=window.webpackJsonp||[]).push([[101],{421:function(s,e,a){"use strict";a.r(e);var n=a(3),t=Object(n.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"一-简单架构图示参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-简单架构图示参考"}},[s._v("#")]),s._v(" 一 简单架构图示参考")]),s._v(" "),e("p",[s._v("更新中...")]),s._v(" "),e("h2",{attrs:{id:"二-部署glance"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-部署glance"}},[s._v("#")]),s._v(" 二 部署glance")]),s._v(" "),e("p",[s._v("yum install memcached python-memcached\nsystemctl enable memcached.service\nsystemctl start memcached.service")]),s._v(" "),e("p",[e("strong",[s._v("step 1：glance关于数据库的操作")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mysql -u root -p #登入数据库\nCREATE DATABASE glance; #新建库keystone\nGRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' \\\n  IDENTIFIED BY '123'; #新建本地访问glance库的账号\nGRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' \\\n  IDENTIFIED BY '123'; #新建远程访问glance库的账号\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[e("strong",[s._v("step 2：glance关于keystone的操作")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('soure admin-openrc #执行管理员脚本\n#为glance的使用者创建用户\nopenstack user create --domain default --password-prompt glance\n\n#对glance-service添加role角色,提示：用户glance只有在一个确定的项目service内才有角色的概念，单独的用户或者单独的项目都是无法绑定角色的。\nopenstack role add --project service --user glance admin\n\n\n#创建glance服务的catalog：service+endpoint\nopenstack service create --name glance \\\n--description "OpenStack Image" image\n\nopenstack endpoint create --region RegionOne \\\nimage public http://192.168.31.57:9292\nopenstack endpoint create --region RegionOne \\\nimage internal http://192.168.31.57:9292\nopenstack endpoint create --region RegionOne \\\nimage admin http://192.168.31.57:9292\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("p",[e("strong",[s._v("step 3：安装软件包")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum -y install openstack-glance\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("step 4：配置/etc/glance/glance.conf")])]),s._v(" "),e("p",[s._v("大前提：每一条配置都应该新增到文件中，一定不要打开注释在原有的基础上修改。")]),s._v(" "),e("p",[s._v("创建本地存储：")]),s._v(" "),e("p",[e("strong",[s._v("1.一定要在opesntack-glance-api.service服务启动之前部署好存储设备，因为该服务在启动时会加载存储驱动检索存储设备，如果事先不存在，就意味着该服务没有识别到任何可用的存储设备，即便是后来你又新增了存储，仍然是无效的，最终导致你上传镜像失败；")])]),s._v(" "),e("p",[e("strong",[s._v("2.一定要赋予opesntack-glance-api.service服务对存储设备的可写权限。")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir -p /var/lib/glance/images\nchown -R glance.glance /var/lib/glance/images\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("配置/etc/glance/glance-api.conf")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[database]\nconnection = mysql+pymysql://glance:123@192.168.31.57/glance\n\n[keystone_authtoken]\nauth_uri = http://192.168.31.57:5000\nauth_url = http://192.168.31.57:35357\nmemcached_servers = 192.168.31.57:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = glance\npassword = 123\n\n[paste_deploy]\nflavor = keystone\n\n[glance_store]\nstores = file,http\ndefault_store = file\nfilesystem_store_datadir = /var/lib/glance/images/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("p",[s._v("配置/etc/glance/glance-registry.conf")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[database]\nconnection = mysql+pymysql://glance:123@192.168.31.57/glance\n\n[keystone_authtoken]\nauth_uri = http://192.168.31.57:5000\nauth_url = http://192.168.31.57:35357\nmemcached_servers = 192.168.31.57:11211\nauth_type = password\nproject_domain_name = Default\nuser_domain_name = Default\nproject_name = service\nusername = glance\npassword = 123\n\n[paste_deploy]\nflavor = keystone\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("p",[e("strong",[s._v("step 5: 初始化数据库glance")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('su -s /bin/sh -c "glance-manage db_sync" glance\n\'\'\'\n忽略以下打印，此乃正常性行为：\nOption "verbose" from group "DEFAULT" is deprecated for removal.  Its value may be silently ignored in the future.\n/usr/lib/python2.7/site-packages/oslo_db/sqlalchemy/enginefacade.py:1171:...... oslo_db.sqlalchemy.enginefacade\n...... a future release.")\n  result = self._query(query)\n\'\'\'\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[e("strong",[s._v("step 6：启动glance且设置开机启动")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("systemctl enable openstack-glance-api.service \\\nopenstack-glance-registry.service\nsystemctl start openstack-glance-api.service \\\nopenstack-glance-registry.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h2",{attrs:{id:"三-验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-验证"}},[s._v("#")]),s._v(" 三 验证")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('source admin-openrc\n\n#如果没有wget则必须yum -y install wget\nwget http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img\n\nopenstack image create "cirros" \\\n  --file cirros-0.3.4-x86_64-disk.img \\\n  --disk-format qcow2 --container-format bare \\\n  --public\n\n\nopenstack image list\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("For information about the openstack image create parameters, see "),e("a",{attrs:{href:"http://docs.openstack.org/user-guide/common/cli-manage-images.html#create-or-update-an-image-glance",target:"_blank",rel:"noopener noreferrer"}},[s._v("Create or update an image (glance)"),e("OutboundLink")],1),s._v(" in the OpenStack User Guide.")]),s._v(" "),e("p",[s._v("For information about disk and container formats for images, see "),e("a",{attrs:{href:"http://docs.openstack.org/image-guide/image-formats.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Disk and container formats "),e("OutboundLink")],1),s._v("for images in the OpenStack Virtual Machine Image Guide.")])])}),[],!1,null,null,null);e.default=t.exports}}]);